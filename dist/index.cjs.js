
  /**
   * @license
   * author: Ryan Feigenbaum
   * footnoter.js v1.0.0
   * Released under the MIT license.
   */

'use strict';

const options = {
    container: "article",
    fnAnchor: ">>",
    refAnchor: "<<",
    background: "#fff",
    text: "#000",
};

const styles = (text, background, width, left, right) => {
    const styles = `
    body {
    }
	.footnote {
		font-size: 12px;
		text-decoration: none;
        border-radius: 50%;
        padding: 0 4px;
        font-variant-numeric: tabular-nums;
        left: -4px;
        font-weight: 700;
        vertical-align: text-top;
        color: inherit;
        scroll-padding: 30px;
	}

    :target {
        margin-top: 1em;
    }

    

    .footnote:hover {
        background: rgba(0 0 0 / .15)
    }

	.reference-preview {
		position: absolute;
		opacity: 0;
		transform: translateY(-1rem);
		left: 0;
        font-weight: 400;
		
		pointer-events: none;
		padding: 3rem .5rem;
		width: ${width}px;
		transition: .4s;
		background: linear-gradient(to top, transparent, ${background},  ${background}, transparent);
		

	}

	.reference-content {
		font-size: 15px;
		background-color: ${background};
		color: ${text};
		border-radius: 9px;
		padding: 1em;
		box-shadow: 0 19px 38px rgba(0,0,0,0.30), 0 15px 12px rgba(0,0,0,0.22);


	}
	
	.footnote:hover .reference-preview {
		opacity: 1;
	}

  .reference-back {
    text-decoration: none;
  }
 
   `;
    const style = document.createElement("style");
    style.textContent = styles;
    document.head.append(style);
};

function createFn(fnRe, str, parentEl) {
    //   let count = [];
    if (fnRe.test(str)) {
        const matches = str.match(fnRe);
        const values = matches?.map((v) => v.replace(">>", ""));
        // count = [...count, ...values];
        // console.log(matches);
        const transformedText = parentEl?.innerText.replace(fnRe, `<a class='footnote' id='$1' href='#ref-$1'>$1</a>`);
        parentEl.innerHTML = transformedText;
        parentEl.setAttribute("style", "position:relative;");
        if (!values)
            return [];
        return values;
    }
    return [];
}

function createRefPreview(refRe, str, parentEl) {
    const matches = str.match(refRe);
    if (!matches || !matches.length)
        throw Error("Couldn't find matches");
    matches.forEach((match) => {
        const number = /\d+/.exec(match);
        if (!number)
            throw Error("Couldn`t extract number");
        const [num] = number;
        const outer = document.createElement("div");
        outer.setAttribute("class", "reference-preview");
        const inner = document.createElement("div");
        inner.setAttribute("class", "reference-content");
        inner.innerHTML = parentEl.innerHTML.replace(/&lt;&lt;(\d+)/g, "$1 | ");
        outer.append(inner);
        document.getElementById(num)?.append(outer);
    });
}

function createRef(refRe, str, parentEl) {
    if (refRe.test(str)) {
        // Need to encode/decode html entities in config
        createRefPreview(refRe, str, parentEl);
        const transformedText = parentEl.innerHTML.replaceAll(/&lt;&lt;(\d+)/g, "$1. ");
        const number = /\d+/.exec(str);
        if (!number)
            throw Error("Couldn`t extract number");
        const [num] = number;
        parentEl.id = `ref-${num}`;
        parentEl.innerHTML = `${transformedText} <a class="reference-back" href="#${num}" aria-label="Back to footnote ${num}">â®Œ</a>`;
        return [num.toString()];
    }
    return [];
}

function init(userOptions) {
    try {
        const config = { ...options, ...userOptions };
        console.log(config);
        const { container, fnAnchor, refAnchor, text, background } = config;
        const fnRe = new RegExp(`${fnAnchor}(\\d+)`, "g");
        const refRe = new RegExp(`${refAnchor}(\\d+)`, "g");
        const combinedRe = new RegExp(`(${fnAnchor}|${refAnchor})\\d+`);
        console.log(combinedRe);
        const article = document.querySelector(container);
        if (!article)
            throw Error("No container found.");
        const containerSize = article?.querySelector("p")?.getBoundingClientRect();
        if (!containerSize)
            throw Error("Can't find container size");
        const { width, left, right } = containerSize;
        styles(text, background, width, left, right);
        const ni = document.createNodeIterator(article, NodeFilter.SHOW_ELEMENT, (node) => {
            if (!node || !node.textContent)
                return NodeFilter.FILTER_REJECT;
            return combinedRe.test(node.textContent)
                ? NodeFilter.FILTER_ACCEPT
                : NodeFilter.FILTER_REJECT;
            // ACCEPT, REJECT OR SKIP based on
            // custom criteria
        });
        if (!ni.referenceNode)
            throw Error("Reference node not found");
        let current;
        let els = [];
        while ((current = ni.nextNode())) {
            els.push(current);
            // const parentEl = current;
            // const str = current.textContent;
            // if (!parentEl) throw Error(`No parent element, ${current}`);
            // if (typeof str !== "string" || !str) throw Error("Nothing to match");
            // createFn(fnRe, str, parentEl);
            // createRef(refRe, str, parentEl);
        }
        const notes = els.slice(1);
        let fn = [], ref = [];
        notes.forEach((note) => {
            const str = note.textContent;
            const parentEl = note;
            if (typeof str !== "string" || !str)
                throw Error("Nothing to match");
            if (!parentEl)
                throw Error(`No parent element, ${note}`);
            let fnCheck = createFn(fnRe, str, parentEl);
            fn = [...fn, ...fnCheck];
            let refCheck = createRef(refRe, str, parentEl);
            ref = [...ref, ...refCheck];
        });
        if (fn.length !== ref.length) {
            const [max, min] = fn.length > ref.length ? [fn, ref] : [ref, fn];
            const missing = max.filter((val) => !min.includes(val)).join(", ");
            const errorMessage = (fn, ref, missing) => {
                return `It looks like there are more ${fn.length > ref.length
                    ? "footnotes (" +
                        fn.length +
                        ")" +
                        " than references (" +
                        ref.length +
                        ")"
                    : "references (" +
                        ref.length +
                        ")" +
                        " than footnotes (" +
                        fn.length +
                        ")"}. Check ${fn.length > ref.length ? "footnote(s)" : "reference(s)"} ${missing}`;
            };
            throw Error(errorMessage(fn, ref, missing));
        }
    }
    catch (e) {
        console.error(e);
    }
}

module.exports = init;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguY2pzLmpzIiwic291cmNlcyI6WyIuLi9zcmMvb3B0aW9ucy50cyIsIi4uL3NyYy9zdHlsZXMudHMiLCIuLi9zcmMvY3JlYXRlRm4udHMiLCIuLi9zcmMvY3JlYXRlUmVmUHJldmlldy50cyIsIi4uL3NyYy9jcmVhdGVSZWYudHMiLCIuLi9zcmMvaW5kZXgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW50ZXJmYWNlIE9wdGlvbnMge1xuICBjb250YWluZXI6IHN0cmluZztcbiAgZm5BbmNob3I6IHN0cmluZztcbiAgcmVmQW5jaG9yOiBzdHJpbmc7XG4gIGJhY2tncm91bmQ6IHN0cmluZztcbiAgdGV4dDogc3RyaW5nO1xufVxuXG5jb25zdCBvcHRpb25zOiBPcHRpb25zID0ge1xuICBjb250YWluZXI6IFwiYXJ0aWNsZVwiLFxuICBmbkFuY2hvcjogXCI+PlwiLFxuICByZWZBbmNob3I6IFwiPDxcIixcbiAgYmFja2dyb3VuZDogXCIjZmZmXCIsXG4gIHRleHQ6IFwiIzAwMFwiLFxufTtcblxuZXhwb3J0IGRlZmF1bHQgb3B0aW9ucztcbiIsImNvbnN0IHN0eWxlcyA9IChcbiAgdGV4dDogc3RyaW5nLFxuICBiYWNrZ3JvdW5kOiBzdHJpbmcsXG4gIHdpZHRoOiBudW1iZXIsXG4gIGxlZnQ6IG51bWJlcixcbiAgcmlnaHQ6IG51bWJlclxuKTogdm9pZCA9PiB7XG4gIGNvbnN0IHN0eWxlcyA9IGBcbiAgICBib2R5IHtcbiAgICB9XG5cdC5mb290bm90ZSB7XG5cdFx0Zm9udC1zaXplOiAxMnB4O1xuXHRcdHRleHQtZGVjb3JhdGlvbjogbm9uZTtcbiAgICAgICAgYm9yZGVyLXJhZGl1czogNTAlO1xuICAgICAgICBwYWRkaW5nOiAwIDRweDtcbiAgICAgICAgZm9udC12YXJpYW50LW51bWVyaWM6IHRhYnVsYXItbnVtcztcbiAgICAgICAgbGVmdDogLTRweDtcbiAgICAgICAgZm9udC13ZWlnaHQ6IDcwMDtcbiAgICAgICAgdmVydGljYWwtYWxpZ246IHRleHQtdG9wO1xuICAgICAgICBjb2xvcjogaW5oZXJpdDtcbiAgICAgICAgc2Nyb2xsLXBhZGRpbmc6IDMwcHg7XG5cdH1cblxuICAgIDp0YXJnZXQge1xuICAgICAgICBtYXJnaW4tdG9wOiAxZW07XG4gICAgfVxuXG4gICAgXG5cbiAgICAuZm9vdG5vdGU6aG92ZXIge1xuICAgICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAgMCAwIC8gLjE1KVxuICAgIH1cblxuXHQucmVmZXJlbmNlLXByZXZpZXcge1xuXHRcdHBvc2l0aW9uOiBhYnNvbHV0ZTtcblx0XHRvcGFjaXR5OiAwO1xuXHRcdHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtMXJlbSk7XG5cdFx0bGVmdDogMDtcbiAgICAgICAgZm9udC13ZWlnaHQ6IDQwMDtcblx0XHRcblx0XHRwb2ludGVyLWV2ZW50czogbm9uZTtcblx0XHRwYWRkaW5nOiAzcmVtIC41cmVtO1xuXHRcdHdpZHRoOiAke3dpZHRofXB4O1xuXHRcdHRyYW5zaXRpb246IC40cztcblx0XHRiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQodG8gdG9wLCB0cmFuc3BhcmVudCwgJHtiYWNrZ3JvdW5kfSwgICR7YmFja2dyb3VuZH0sIHRyYW5zcGFyZW50KTtcblx0XHRcblxuXHR9XG5cblx0LnJlZmVyZW5jZS1jb250ZW50IHtcblx0XHRmb250LXNpemU6IDE1cHg7XG5cdFx0YmFja2dyb3VuZC1jb2xvcjogJHtiYWNrZ3JvdW5kfTtcblx0XHRjb2xvcjogJHt0ZXh0fTtcblx0XHRib3JkZXItcmFkaXVzOiA5cHg7XG5cdFx0cGFkZGluZzogMWVtO1xuXHRcdGJveC1zaGFkb3c6IDAgMTlweCAzOHB4IHJnYmEoMCwwLDAsMC4zMCksIDAgMTVweCAxMnB4IHJnYmEoMCwwLDAsMC4yMik7XG5cblxuXHR9XG5cdFxuXHQuZm9vdG5vdGU6aG92ZXIgLnJlZmVyZW5jZS1wcmV2aWV3IHtcblx0XHRvcGFjaXR5OiAxO1xuXHR9XG5cbiAgLnJlZmVyZW5jZS1iYWNrIHtcbiAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7XG4gIH1cbiBcbiAgIGA7XG4gIGNvbnN0IHN0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInN0eWxlXCIpO1xuICBzdHlsZS50ZXh0Q29udGVudCA9IHN0eWxlcztcbiAgZG9jdW1lbnQuaGVhZC5hcHBlbmQoc3R5bGUpO1xufTtcblxuZXhwb3J0IGRlZmF1bHQgc3R5bGVzO1xuIiwiZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gY3JlYXRlRm4oXG4gIGZuUmU6IFJlZ0V4cCxcbiAgc3RyOiBzdHJpbmcsXG4gIHBhcmVudEVsOiBIVE1MRWxlbWVudFxuKTogc3RyaW5nW10ge1xuICAvLyAgIGxldCBjb3VudCA9IFtdO1xuXG4gIGlmIChmblJlLnRlc3Qoc3RyKSkge1xuICAgIGNvbnN0IG1hdGNoZXMgPSBzdHIubWF0Y2goZm5SZSk7XG4gICAgY29uc3QgdmFsdWVzID0gbWF0Y2hlcz8ubWFwKCh2KSA9PiB2LnJlcGxhY2UoXCI+PlwiLCBcIlwiKSk7XG5cbiAgICAvLyBjb3VudCA9IFsuLi5jb3VudCwgLi4udmFsdWVzXTtcbiAgICAvLyBjb25zb2xlLmxvZyhtYXRjaGVzKTtcblxuICAgIGNvbnN0IHRyYW5zZm9ybWVkVGV4dCA9IHBhcmVudEVsPy5pbm5lclRleHQucmVwbGFjZShcbiAgICAgIGZuUmUsXG4gICAgICBgPGEgY2xhc3M9J2Zvb3Rub3RlJyBpZD0nJDEnIGhyZWY9JyNyZWYtJDEnPiQxPC9hPmBcbiAgICApO1xuICAgIHBhcmVudEVsLmlubmVySFRNTCA9IHRyYW5zZm9ybWVkVGV4dDtcbiAgICBwYXJlbnRFbC5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBcInBvc2l0aW9uOnJlbGF0aXZlO1wiKTtcbiAgICBpZiAoIXZhbHVlcykgcmV0dXJuIFtdO1xuICAgIHJldHVybiB2YWx1ZXM7XG4gIH1cblxuICByZXR1cm4gW107XG59XG4iLCJleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBjcmVhdGVSZWZQcmV2aWV3KFxuICByZWZSZTogUmVnRXhwLFxuICBzdHI6IHN0cmluZyxcbiAgcGFyZW50RWw6IEhUTUxFbGVtZW50XG4pOiB2b2lkIHtcbiAgY29uc3QgbWF0Y2hlcyA9IHN0ci5tYXRjaChyZWZSZSk7XG5cbiAgaWYgKCFtYXRjaGVzIHx8ICFtYXRjaGVzLmxlbmd0aCkgdGhyb3cgRXJyb3IoXCJDb3VsZG4ndCBmaW5kIG1hdGNoZXNcIik7XG5cbiAgbWF0Y2hlcy5mb3JFYWNoKChtYXRjaCkgPT4ge1xuICAgIGNvbnN0IG51bWJlciA9IC9cXGQrLy5leGVjKG1hdGNoKTtcbiAgICBpZiAoIW51bWJlcikgdGhyb3cgRXJyb3IoXCJDb3VsZG5gdCBleHRyYWN0IG51bWJlclwiKTtcblxuICAgIGNvbnN0IFtudW1dID0gbnVtYmVyO1xuXG4gICAgY29uc3Qgb3V0ZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIG91dGVyLnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIFwicmVmZXJlbmNlLXByZXZpZXdcIik7XG4gICAgY29uc3QgaW5uZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIGlubmVyLnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIFwicmVmZXJlbmNlLWNvbnRlbnRcIik7XG5cbiAgICBpbm5lci5pbm5lckhUTUwgPSBwYXJlbnRFbC5pbm5lckhUTUwucmVwbGFjZSgvJmx0OyZsdDsoXFxkKykvZywgXCIkMSB8IFwiKTtcbiAgICBvdXRlci5hcHBlbmQoaW5uZXIpO1xuXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobnVtKT8uYXBwZW5kKG91dGVyKTtcbiAgfSk7XG59XG4iLCJpbXBvcnQgY3JlYXRlUmVmUHJldmlldyBmcm9tIFwiLi9jcmVhdGVSZWZQcmV2aWV3XCI7XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGNyZWF0ZVJlZihcbiAgcmVmUmU6IFJlZ0V4cCxcbiAgc3RyOiBzdHJpbmcsXG4gIHBhcmVudEVsOiBIVE1MRWxlbWVudFxuKTogc3RyaW5nW10ge1xuICBpZiAocmVmUmUudGVzdChzdHIpKSB7XG4gICAgLy8gTmVlZCB0byBlbmNvZGUvZGVjb2RlIGh0bWwgZW50aXRpZXMgaW4gY29uZmlnXG4gICAgY3JlYXRlUmVmUHJldmlldyhyZWZSZSwgc3RyLCBwYXJlbnRFbCk7XG5cbiAgICBjb25zdCB0cmFuc2Zvcm1lZFRleHQgPSBwYXJlbnRFbC5pbm5lckhUTUwucmVwbGFjZUFsbChcbiAgICAgIC8mbHQ7Jmx0OyhcXGQrKS9nLFxuICAgICAgXCIkMS4gXCJcbiAgICApO1xuXG4gICAgY29uc3QgbnVtYmVyID0gL1xcZCsvLmV4ZWMoc3RyKTtcblxuICAgIGlmICghbnVtYmVyKSB0aHJvdyBFcnJvcihcIkNvdWxkbmB0IGV4dHJhY3QgbnVtYmVyXCIpO1xuXG4gICAgY29uc3QgW251bV0gPSBudW1iZXI7XG5cbiAgICBwYXJlbnRFbC5pZCA9IGByZWYtJHtudW19YDtcblxuICAgIHBhcmVudEVsLmlubmVySFRNTCA9IGAke3RyYW5zZm9ybWVkVGV4dH0gPGEgY2xhc3M9XCJyZWZlcmVuY2UtYmFja1wiIGhyZWY9XCIjJHtudW19XCIgYXJpYS1sYWJlbD1cIkJhY2sgdG8gZm9vdG5vdGUgJHtudW19XCI+4q6MPC9hPmA7XG5cbiAgICByZXR1cm4gW251bS50b1N0cmluZygpXTtcbiAgfVxuICByZXR1cm4gW107XG59XG4iLCJpbXBvcnQgb3B0aW9ucyBmcm9tIFwiLi9vcHRpb25zXCI7XG5pbXBvcnQgc3R5bGVzIGZyb20gXCIuL3N0eWxlc1wiO1xuaW1wb3J0IGNyZWF0ZUZuIGZyb20gXCIuL2NyZWF0ZUZuXCI7XG5pbXBvcnQgY3JlYXRlUmVmIGZyb20gXCIuL2NyZWF0ZVJlZlwiO1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBpbml0KHVzZXJPcHRpb25zOiB7XG4gIGNvbnRhaW5lcj86IHN0cmluZztcbiAgZm5BbmNob3I/OiBzdHJpbmc7XG4gIHJlZkFuY2hvcj86IHN0cmluZztcbiAgdGV4dD86IHN0cmluZztcbiAgYmFja2dyb3VuZD86IHN0cmluZztcbn0pOiB2b2lkIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBjb25maWcgPSB7IC4uLm9wdGlvbnMsIC4uLnVzZXJPcHRpb25zIH07XG4gICAgY29uc29sZS5sb2coY29uZmlnKTtcbiAgICBjb25zdCB7IGNvbnRhaW5lciwgZm5BbmNob3IsIHJlZkFuY2hvciwgdGV4dCwgYmFja2dyb3VuZCB9ID0gY29uZmlnO1xuXG4gICAgY29uc3QgZm5SZSA9IG5ldyBSZWdFeHAoYCR7Zm5BbmNob3J9KFxcXFxkKylgLCBcImdcIik7XG4gICAgY29uc3QgcmVmUmUgPSBuZXcgUmVnRXhwKGAke3JlZkFuY2hvcn0oXFxcXGQrKWAsIFwiZ1wiKTtcbiAgICBjb25zdCBjb21iaW5lZFJlID0gbmV3IFJlZ0V4cChgKCR7Zm5BbmNob3J9fCR7cmVmQW5jaG9yfSlcXFxcZCtgKTtcbiAgICBjb25zb2xlLmxvZyhjb21iaW5lZFJlKTtcbiAgICBjb25zdCBhcnRpY2xlID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihjb250YWluZXIpO1xuXG4gICAgaWYgKCFhcnRpY2xlKSB0aHJvdyBFcnJvcihcIk5vIGNvbnRhaW5lciBmb3VuZC5cIik7XG5cbiAgICBjb25zdCBjb250YWluZXJTaXplID0gYXJ0aWNsZT8ucXVlcnlTZWxlY3RvcihcInBcIik/LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXG4gICAgaWYgKCFjb250YWluZXJTaXplKSB0aHJvdyBFcnJvcihcIkNhbid0IGZpbmQgY29udGFpbmVyIHNpemVcIik7XG5cbiAgICBjb25zdCB7IHdpZHRoLCBsZWZ0LCByaWdodCB9ID0gY29udGFpbmVyU2l6ZTtcblxuICAgIHN0eWxlcyh0ZXh0LCBiYWNrZ3JvdW5kLCB3aWR0aCwgbGVmdCwgcmlnaHQpO1xuXG4gICAgY29uc3QgbmkgPSBkb2N1bWVudC5jcmVhdGVOb2RlSXRlcmF0b3IoXG4gICAgICBhcnRpY2xlLFxuICAgICAgTm9kZUZpbHRlci5TSE9XX0VMRU1FTlQsXG4gICAgICAobm9kZSkgPT4ge1xuICAgICAgICBpZiAoIW5vZGUgfHwgIW5vZGUudGV4dENvbnRlbnQpIHJldHVybiBOb2RlRmlsdGVyLkZJTFRFUl9SRUpFQ1Q7XG4gICAgICAgIHJldHVybiBjb21iaW5lZFJlLnRlc3Qobm9kZS50ZXh0Q29udGVudClcbiAgICAgICAgICA/IE5vZGVGaWx0ZXIuRklMVEVSX0FDQ0VQVFxuICAgICAgICAgIDogTm9kZUZpbHRlci5GSUxURVJfUkVKRUNUO1xuICAgICAgICAvLyBBQ0NFUFQsIFJFSkVDVCBPUiBTS0lQIGJhc2VkIG9uXG4gICAgICAgIC8vIGN1c3RvbSBjcml0ZXJpYVxuICAgICAgfVxuICAgICk7XG5cbiAgICBpZiAoIW5pLnJlZmVyZW5jZU5vZGUpIHRocm93IEVycm9yKFwiUmVmZXJlbmNlIG5vZGUgbm90IGZvdW5kXCIpO1xuXG4gICAgbGV0IGN1cnJlbnQ7XG4gICAgbGV0IGVscyA9IFtdO1xuXG4gICAgd2hpbGUgKChjdXJyZW50ID0gbmkubmV4dE5vZGUoKSkpIHtcbiAgICAgIGVscy5wdXNoKGN1cnJlbnQpO1xuICAgICAgLy8gY29uc3QgcGFyZW50RWwgPSBjdXJyZW50O1xuICAgICAgLy8gY29uc3Qgc3RyID0gY3VycmVudC50ZXh0Q29udGVudDtcblxuICAgICAgLy8gaWYgKCFwYXJlbnRFbCkgdGhyb3cgRXJyb3IoYE5vIHBhcmVudCBlbGVtZW50LCAke2N1cnJlbnR9YCk7XG5cbiAgICAgIC8vIGlmICh0eXBlb2Ygc3RyICE9PSBcInN0cmluZ1wiIHx8ICFzdHIpIHRocm93IEVycm9yKFwiTm90aGluZyB0byBtYXRjaFwiKTtcblxuICAgICAgLy8gY3JlYXRlRm4oZm5SZSwgc3RyLCBwYXJlbnRFbCk7XG5cbiAgICAgIC8vIGNyZWF0ZVJlZihyZWZSZSwgc3RyLCBwYXJlbnRFbCk7XG4gICAgfVxuXG4gICAgY29uc3Qgbm90ZXMgPSBlbHMuc2xpY2UoMSk7XG4gICAgbGV0IGZuOiBzdHJpbmdbXSA9IFtdLFxuICAgICAgcmVmOiBzdHJpbmdbXSA9IFtdO1xuICAgIG5vdGVzLmZvckVhY2goKG5vdGUpID0+IHtcbiAgICAgIGNvbnN0IHN0ciA9IG5vdGUudGV4dENvbnRlbnQ7XG4gICAgICBjb25zdCBwYXJlbnRFbCA9IG5vdGUgYXMgSFRNTEVsZW1lbnQ7XG5cbiAgICAgIGlmICh0eXBlb2Ygc3RyICE9PSBcInN0cmluZ1wiIHx8ICFzdHIpIHRocm93IEVycm9yKFwiTm90aGluZyB0byBtYXRjaFwiKTtcblxuICAgICAgaWYgKCFwYXJlbnRFbCkgdGhyb3cgRXJyb3IoYE5vIHBhcmVudCBlbGVtZW50LCAke25vdGV9YCk7XG5cbiAgICAgIGxldCBmbkNoZWNrID0gY3JlYXRlRm4oZm5SZSwgc3RyLCBwYXJlbnRFbCk7XG5cbiAgICAgIGZuID0gWy4uLmZuLCAuLi5mbkNoZWNrXTtcblxuICAgICAgbGV0IHJlZkNoZWNrID0gY3JlYXRlUmVmKHJlZlJlLCBzdHIsIHBhcmVudEVsKTtcbiAgICAgIHJlZiA9IFsuLi5yZWYsIC4uLnJlZkNoZWNrXTtcbiAgICB9KTtcblxuICAgIGlmIChmbi5sZW5ndGggIT09IHJlZi5sZW5ndGgpIHtcbiAgICAgIGNvbnN0IFttYXgsIG1pbl0gPSBmbi5sZW5ndGggPiByZWYubGVuZ3RoID8gW2ZuLCByZWZdIDogW3JlZiwgZm5dO1xuXG4gICAgICBjb25zdCBtaXNzaW5nID0gbWF4LmZpbHRlcigodmFsKSA9PiAhbWluLmluY2x1ZGVzKHZhbCkpLmpvaW4oXCIsIFwiKTtcblxuICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gKFxuICAgICAgICBmbjogc3RyaW5nW10sXG4gICAgICAgIHJlZjogc3RyaW5nW10sXG4gICAgICAgIG1pc3Npbmc6IHN0cmluZ1xuICAgICAgKTogc3RyaW5nID0+IHtcbiAgICAgICAgcmV0dXJuIGBJdCBsb29rcyBsaWtlIHRoZXJlIGFyZSBtb3JlICR7XG4gICAgICAgICAgZm4ubGVuZ3RoID4gcmVmLmxlbmd0aFxuICAgICAgICAgICAgPyBcImZvb3Rub3RlcyAoXCIgK1xuICAgICAgICAgICAgICBmbi5sZW5ndGggK1xuICAgICAgICAgICAgICBcIilcIiArXG4gICAgICAgICAgICAgIFwiIHRoYW4gcmVmZXJlbmNlcyAoXCIgK1xuICAgICAgICAgICAgICByZWYubGVuZ3RoICtcbiAgICAgICAgICAgICAgXCIpXCJcbiAgICAgICAgICAgIDogXCJyZWZlcmVuY2VzIChcIiArXG4gICAgICAgICAgICAgIHJlZi5sZW5ndGggK1xuICAgICAgICAgICAgICBcIilcIiArXG4gICAgICAgICAgICAgIFwiIHRoYW4gZm9vdG5vdGVzIChcIiArXG4gICAgICAgICAgICAgIGZuLmxlbmd0aCArXG4gICAgICAgICAgICAgIFwiKVwiXG4gICAgICAgIH0uIENoZWNrICR7XG4gICAgICAgICAgZm4ubGVuZ3RoID4gcmVmLmxlbmd0aCA/IFwiZm9vdG5vdGUocylcIiA6IFwicmVmZXJlbmNlKHMpXCJcbiAgICAgICAgfSAke21pc3Npbmd9YDtcbiAgICAgIH07XG4gICAgICB0aHJvdyBFcnJvcihlcnJvck1lc3NhZ2UoZm4sIHJlZiwgbWlzc2luZykpO1xuICAgIH1cbiAgfSBjYXRjaCAoZSkge1xuICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gIH1cbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBUUEsTUFBTSxPQUFPLEdBQVk7QUFDdkIsSUFBQSxTQUFTLEVBQUUsU0FBUztBQUNwQixJQUFBLFFBQVEsRUFBRSxJQUFJO0FBQ2QsSUFBQSxTQUFTLEVBQUUsSUFBSTtBQUNmLElBQUEsVUFBVSxFQUFFLE1BQU07QUFDbEIsSUFBQSxJQUFJLEVBQUUsTUFBTTtDQUNiOztBQ2RELE1BQU0sTUFBTSxHQUFHLENBQ2IsSUFBWSxFQUNaLFVBQWtCLEVBQ2xCLEtBQWEsRUFDYixJQUFZLEVBQ1osS0FBYSxLQUNMO0FBQ1IsSUFBQSxNQUFNLE1BQU0sR0FBRyxDQUFBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztXQW1DTixLQUFLLENBQUE7O0FBRXFDLG1EQUFBLEVBQUEsVUFBVSxNQUFNLFVBQVUsQ0FBQTs7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
