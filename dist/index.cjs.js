
  /**
   * @license
   * author: Ryan Feigenbaum
   * footnoter.js v1.0.0
   * Released under the MIT license.
   */

'use strict';

const options = {
    container: "article",
    fnAnchor: ">>",
    refAnchor: "<<",
    background: "#fff",
    text: "#000",
};

const styles = (text, background, width, left, right) => {
    const styles = `
    body {
    }
	.footnote {
		font-size: 12px;
		text-decoration: none;
        border-radius: 50%;
        padding: 0 4px;
        font-variant-numeric: tabular-nums;
        left: -4px;
        font-weight: 700;
        vertical-align: text-top;
        color: inherit;
        scroll-padding: 30px;
	}

    :target {
        margin-top: 1em;
    }

    

    .footnote:hover {
        background: rgba(0 0 0 / .15)
    }

	.reference-preview {
		position: absolute;
		opacity: 0;
		transform: translateY(-1rem);
		left: 0;
        font-weight: 400;
		
		pointer-events: none;
		padding: 3rem .5rem;
		width: ${width}px;
		transition: .4s;
		background: linear-gradient(to top, transparent, ${background},  ${background}, transparent);
		

	}

	.reference-content {
		font-size: 15px;
		background-color: ${background};
		color: ${text};
		border-radius: 9px;
		padding: 1em;
		box-shadow: 0 19px 38px rgba(0,0,0,0.30), 0 15px 12px rgba(0,0,0,0.22);


	}
	
	.footnote:hover .reference-preview {
		opacity: 1;
	}

  .reference-back {
    text-decoration: none;
  }
 
   `;
    const style = document.createElement("style");
    style.textContent = styles;
    document.head.append(style);
};

function createFn(fnRe, str, parentEl) {
    //   let count = [];
    if (fnRe.test(str)) {
        const matches = str.match(fnRe);
        const values = matches?.map((v) => v.replace(">>", ""));
        // count = [...count, ...values];
        // console.log(matches);
        const transformedText = parentEl?.innerText.replace(fnRe, `<a class='footnote' id='$1' href='#ref-$1'>$1</a>`);
        parentEl.innerHTML = transformedText;
        parentEl.setAttribute("style", "position:relative;");
        if (!values)
            return [];
        return values;
    }
    return [];
}

function createRefPreview(refRe, str, parentEl) {
    const matches = str.match(refRe);
    if (!matches || !matches.length)
        throw Error("Couldn't find matches");
    matches.forEach((match) => {
        const number = /\d+/.exec(match);
        if (!number)
            throw Error("Couldn`t extract number");
        const [num] = number;
        const outer = document.createElement("div");
        outer.setAttribute("class", "reference-preview");
        const inner = document.createElement("div");
        inner.setAttribute("class", "reference-content");
        inner.innerHTML = parentEl.innerHTML.replace(/&lt;&lt;(\d+)/g, "$1 | ");
        outer.append(inner);
        document.getElementById(num)?.append(outer);
    });
}

function createRef(refRe, str, parentEl) {
    if (refRe.test(str)) {
        // Need to encode/decode html entities in config
        createRefPreview(refRe, str, parentEl);
        const transformedText = parentEl.innerHTML.replaceAll(/&lt;&lt;(\d+)/g, "$1. ");
        const number = /\d+/.exec(str);
        if (!number)
            throw Error("Couldn`t extract number for reference");
        const [num] = number;
        parentEl.id = `ref-${num}`;
        parentEl.innerHTML = `${transformedText} <a class="reference-back" href="#${num}" aria-label="Back to footnote ${num}">â®Œ</a>`;
        return [num.toString()];
    }
    return [];
}

function init(userOptions) {
    try {
        const config = { ...options, ...userOptions };
        console.log(config);
        const { container, fnAnchor, refAnchor, text, background } = config;
        const fnRe = new RegExp(`${fnAnchor}(\\d+)`, "g");
        const refRe = new RegExp(`${refAnchor}(\\d+)`, "g");
        const combinedRe = new RegExp(`(${fnAnchor}|${refAnchor})\\d+`);
        console.log(combinedRe);
        const article = document.querySelector(container);
        if (!article)
            throw Error("No container found.");
        const containerSize = article?.querySelector("p")?.getBoundingClientRect();
        if (!containerSize)
            throw Error("Can't find container size");
        const { width, left, right } = containerSize;
        styles(text, background, width, left, right);
        const ni = document.createNodeIterator(article, NodeFilter.SHOW_ELEMENT, (node) => {
            if (!node || !node.textContent)
                return NodeFilter.FILTER_REJECT;
            return combinedRe.test(node.textContent)
                ? NodeFilter.FILTER_ACCEPT
                : NodeFilter.FILTER_REJECT;
            // ACCEPT, REJECT OR SKIP based on
            // custom criteria
        });
        if (!ni.referenceNode)
            throw Error("Reference node not found");
        let current;
        let els = [];
        while ((current = ni.nextNode())) {
            els.push(current);
            // const parentEl = current;
            // const str = current.textContent;
            // if (!parentEl) throw Error(`No parent element, ${current}`);
            // if (typeof str !== "string" || !str) throw Error("Nothing to match");
            // createFn(fnRe, str, parentEl);
            // createRef(refRe, str, parentEl);
        }
        const notes = els.slice(1);
        let fn = [], ref = [];
        notes.forEach((note) => {
            const str = note.textContent;
            const parentEl = note;
            if (typeof str !== "string" || !str)
                throw Error("Nothing to match");
            if (!parentEl)
                throw Error(`No parent element, ${note}`);
            let fnCheck = createFn(fnRe, str, parentEl);
            fn = [...fn, ...fnCheck];
            let refCheck = createRef(refRe, str, parentEl);
            ref = [...ref, ...refCheck];
        });
        if (fn.length !== ref.length) {
            const [max, min] = fn.length > ref.length ? [fn, ref] : [ref, fn];
            const missing = max.filter((val) => !min.includes(val)).join(", ");
            const errorMessage = (fn, ref, missing) => {
                return `It looks like there are more ${fn.length > ref.length
                    ? "footnotes (" +
                        fn.length +
                        ")" +
                        " than references (" +
                        ref.length +
                        ")"
                    : "references (" +
                        ref.length +
                        ")" +
                        " than footnotes (" +
                        fn.length +
                        ")"}. Check ${fn.length > ref.length ? "footnote(s)" : "reference(s)"} ${missing}`;
            };
            throw Error(errorMessage(fn, ref, missing));
        }
    }
    catch (e) {
        console.error(e);
    }
}

module.exports = init;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguY2pzLmpzIiwic291cmNlcyI6WyIuLi9zcmMvb3B0aW9ucy50cyIsIi4uL3NyYy9zdHlsZXMudHMiLCIuLi9zcmMvY3JlYXRlRm4udHMiLCIuLi9zcmMvY3JlYXRlUmVmUHJldmlldy50cyIsIi4uL3NyYy9jcmVhdGVSZWYudHMiLCIuLi9zcmMvaW5kZXgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW50ZXJmYWNlIE9wdGlvbnMge1xuICBjb250YWluZXI6IHN0cmluZztcbiAgZm5BbmNob3I6IHN0cmluZztcbiAgcmVmQW5jaG9yOiBzdHJpbmc7XG4gIGJhY2tncm91bmQ6IHN0cmluZztcbiAgdGV4dDogc3RyaW5nO1xufVxuXG5jb25zdCBvcHRpb25zOiBPcHRpb25zID0ge1xuICBjb250YWluZXI6IFwiYXJ0aWNsZVwiLFxuICBmbkFuY2hvcjogXCI+PlwiLFxuICByZWZBbmNob3I6IFwiPDxcIixcbiAgYmFja2dyb3VuZDogXCIjZmZmXCIsXG4gIHRleHQ6IFwiIzAwMFwiLFxufTtcblxuZXhwb3J0IGRlZmF1bHQgb3B0aW9ucztcbiIsImNvbnN0IHN0eWxlcyA9IChcbiAgdGV4dDogc3RyaW5nLFxuICBiYWNrZ3JvdW5kOiBzdHJpbmcsXG4gIHdpZHRoOiBudW1iZXIsXG4gIGxlZnQ6IG51bWJlcixcbiAgcmlnaHQ6IG51bWJlclxuKTogdm9pZCA9PiB7XG4gIGNvbnN0IHN0eWxlcyA9IGBcbiAgICBib2R5IHtcbiAgICB9XG5cdC5mb290bm90ZSB7XG5cdFx0Zm9udC1zaXplOiAxMnB4O1xuXHRcdHRleHQtZGVjb3JhdGlvbjogbm9uZTtcbiAgICAgICAgYm9yZGVyLXJhZGl1czogNTAlO1xuICAgICAgICBwYWRkaW5nOiAwIDRweDtcbiAgICAgICAgZm9udC12YXJpYW50LW51bWVyaWM6IHRhYnVsYXItbnVtcztcbiAgICAgICAgbGVmdDogLTRweDtcbiAgICAgICAgZm9udC13ZWlnaHQ6IDcwMDtcbiAgICAgICAgdmVydGljYWwtYWxpZ246IHRleHQtdG9wO1xuICAgICAgICBjb2xvcjogaW5oZXJpdDtcbiAgICAgICAgc2Nyb2xsLXBhZGRpbmc6IDMwcHg7XG5cdH1cblxuICAgIDp0YXJnZXQge1xuICAgICAgICBtYXJnaW4tdG9wOiAxZW07XG4gICAgfVxuXG4gICAgXG5cbiAgICAuZm9vdG5vdGU6aG92ZXIge1xuICAgICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAgMCAwIC8gLjE1KVxuICAgIH1cblxuXHQucmVmZXJlbmNlLXByZXZpZXcge1xuXHRcdHBvc2l0aW9uOiBhYnNvbHV0ZTtcblx0XHRvcGFjaXR5OiAwO1xuXHRcdHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtMXJlbSk7XG5cdFx0bGVmdDogMDtcbiAgICAgICAgZm9udC13ZWlnaHQ6IDQwMDtcblx0XHRcblx0XHRwb2ludGVyLWV2ZW50czogbm9uZTtcblx0XHRwYWRkaW5nOiAzcmVtIC41cmVtO1xuXHRcdHdpZHRoOiAke3dpZHRofXB4O1xuXHRcdHRyYW5zaXRpb246IC40cztcblx0XHRiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQodG8gdG9wLCB0cmFuc3BhcmVudCwgJHtiYWNrZ3JvdW5kfSwgICR7YmFja2dyb3VuZH0sIHRyYW5zcGFyZW50KTtcblx0XHRcblxuXHR9XG5cblx0LnJlZmVyZW5jZS1jb250ZW50IHtcblx0XHRmb250LXNpemU6IDE1cHg7XG5cdFx0YmFja2dyb3VuZC1jb2xvcjogJHtiYWNrZ3JvdW5kfTtcblx0XHRjb2xvcjogJHt0ZXh0fTtcblx0XHRib3JkZXItcmFkaXVzOiA5cHg7XG5cdFx0cGFkZGluZzogMWVtO1xuXHRcdGJveC1zaGFkb3c6IDAgMTlweCAzOHB4IHJnYmEoMCwwLDAsMC4zMCksIDAgMTVweCAxMnB4IHJnYmEoMCwwLDAsMC4yMik7XG5cblxuXHR9XG5cdFxuXHQuZm9vdG5vdGU6aG92ZXIgLnJlZmVyZW5jZS1wcmV2aWV3IHtcblx0XHRvcGFjaXR5OiAxO1xuXHR9XG5cbiAgLnJlZmVyZW5jZS1iYWNrIHtcbiAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7XG4gIH1cbiBcbiAgIGA7XG4gIGNvbnN0IHN0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInN0eWxlXCIpO1xuICBzdHlsZS50ZXh0Q29udGVudCA9IHN0eWxlcztcbiAgZG9jdW1lbnQuaGVhZC5hcHBlbmQoc3R5bGUpO1xufTtcblxuZXhwb3J0IGRlZmF1bHQgc3R5bGVzO1xuIiwiZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gY3JlYXRlRm4oXG4gIGZuUmU6IFJlZ0V4cCxcbiAgc3RyOiBzdHJpbmcsXG4gIHBhcmVudEVsOiBIVE1MRWxlbWVudFxuKTogc3RyaW5nW10ge1xuICAvLyAgIGxldCBjb3VudCA9IFtdO1xuXG4gIGlmIChmblJlLnRlc3Qoc3RyKSkge1xuICAgIGNvbnN0IG1hdGNoZXMgPSBzdHIubWF0Y2goZm5SZSk7XG4gICAgY29uc3QgdmFsdWVzID0gbWF0Y2hlcz8ubWFwKCh2KSA9PiB2LnJlcGxhY2UoXCI+PlwiLCBcIlwiKSk7XG5cbiAgICAvLyBjb3VudCA9IFsuLi5jb3VudCwgLi4udmFsdWVzXTtcbiAgICAvLyBjb25zb2xlLmxvZyhtYXRjaGVzKTtcblxuICAgIGNvbnN0IHRyYW5zZm9ybWVkVGV4dCA9IHBhcmVudEVsPy5pbm5lclRleHQucmVwbGFjZShcbiAgICAgIGZuUmUsXG4gICAgICBgPGEgY2xhc3M9J2Zvb3Rub3RlJyBpZD0nJDEnIGhyZWY9JyNyZWYtJDEnPiQxPC9hPmBcbiAgICApO1xuICAgIHBhcmVudEVsLmlubmVySFRNTCA9IHRyYW5zZm9ybWVkVGV4dDtcbiAgICBwYXJlbnRFbC5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBcInBvc2l0aW9uOnJlbGF0aXZlO1wiKTtcbiAgICBpZiAoIXZhbHVlcykgcmV0dXJuIFtdO1xuICAgIHJldHVybiB2YWx1ZXM7XG4gIH1cblxuICByZXR1cm4gW107XG59XG4iLCJleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBjcmVhdGVSZWZQcmV2aWV3KFxuICByZWZSZTogUmVnRXhwLFxuICBzdHI6IHN0cmluZyxcbiAgcGFyZW50RWw6IEhUTUxFbGVtZW50XG4pOiB2b2lkIHtcbiAgY29uc3QgbWF0Y2hlcyA9IHN0ci5tYXRjaChyZWZSZSk7XG5cbiAgaWYgKCFtYXRjaGVzIHx8ICFtYXRjaGVzLmxlbmd0aCkgdGhyb3cgRXJyb3IoXCJDb3VsZG4ndCBmaW5kIG1hdGNoZXNcIik7XG5cbiAgbWF0Y2hlcy5mb3JFYWNoKChtYXRjaCkgPT4ge1xuICAgIGNvbnN0IG51bWJlciA9IC9cXGQrLy5leGVjKG1hdGNoKTtcbiAgICBpZiAoIW51bWJlcikgdGhyb3cgRXJyb3IoXCJDb3VsZG5gdCBleHRyYWN0IG51bWJlclwiKTtcblxuICAgIGNvbnN0IFtudW1dID0gbnVtYmVyO1xuXG4gICAgY29uc3Qgb3V0ZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIG91dGVyLnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIFwicmVmZXJlbmNlLXByZXZpZXdcIik7XG4gICAgY29uc3QgaW5uZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIGlubmVyLnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIFwicmVmZXJlbmNlLWNvbnRlbnRcIik7XG5cbiAgICBpbm5lci5pbm5lckhUTUwgPSBwYXJlbnRFbC5pbm5lckhUTUwucmVwbGFjZSgvJmx0OyZsdDsoXFxkKykvZywgXCIkMSB8IFwiKTtcbiAgICBvdXRlci5hcHBlbmQoaW5uZXIpO1xuXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobnVtKT8uYXBwZW5kKG91dGVyKTtcbiAgfSk7XG59XG4iLCJpbXBvcnQgY3JlYXRlUmVmUHJldmlldyBmcm9tIFwiLi9jcmVhdGVSZWZQcmV2aWV3XCI7XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGNyZWF0ZVJlZihcbiAgcmVmUmU6IFJlZ0V4cCxcbiAgc3RyOiBzdHJpbmcsXG4gIHBhcmVudEVsOiBIVE1MRWxlbWVudFxuKTogc3RyaW5nW10ge1xuICBpZiAocmVmUmUudGVzdChzdHIpKSB7XG4gICAgLy8gTmVlZCB0byBlbmNvZGUvZGVjb2RlIGh0bWwgZW50aXRpZXMgaW4gY29uZmlnXG4gICAgY3JlYXRlUmVmUHJldmlldyhyZWZSZSwgc3RyLCBwYXJlbnRFbCk7XG5cbiAgICBjb25zdCB0cmFuc2Zvcm1lZFRleHQgPSBwYXJlbnRFbC5pbm5lckhUTUwucmVwbGFjZUFsbChcbiAgICAgIC8mbHQ7Jmx0OyhcXGQrKS9nLFxuICAgICAgXCIkMS4gXCJcbiAgICApO1xuXG4gICAgY29uc3QgbnVtYmVyID0gL1xcZCsvLmV4ZWMoc3RyKTtcblxuICAgIGlmICghbnVtYmVyKSB0aHJvdyBFcnJvcihcIkNvdWxkbmB0IGV4dHJhY3QgbnVtYmVyIGZvciByZWZlcmVuY2VcIik7XG5cbiAgICBjb25zdCBbbnVtXSA9IG51bWJlcjtcblxuICAgIHBhcmVudEVsLmlkID0gYHJlZi0ke251bX1gO1xuXG4gICAgcGFyZW50RWwuaW5uZXJIVE1MID0gYCR7dHJhbnNmb3JtZWRUZXh0fSA8YSBjbGFzcz1cInJlZmVyZW5jZS1iYWNrXCIgaHJlZj1cIiMke251bX1cIiBhcmlhLWxhYmVsPVwiQmFjayB0byBmb290bm90ZSAke251bX1cIj7irow8L2E+YDtcblxuICAgIHJldHVybiBbbnVtLnRvU3RyaW5nKCldO1xuICB9XG5cbiAgcmV0dXJuIFtdO1xufVxuIiwiaW1wb3J0IG9wdGlvbnMgZnJvbSBcIi4vb3B0aW9uc1wiO1xuaW1wb3J0IHN0eWxlcyBmcm9tIFwiLi9zdHlsZXNcIjtcbmltcG9ydCBjcmVhdGVGbiBmcm9tIFwiLi9jcmVhdGVGblwiO1xuaW1wb3J0IGNyZWF0ZVJlZiBmcm9tIFwiLi9jcmVhdGVSZWZcIjtcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gaW5pdCh1c2VyT3B0aW9uczoge1xuICBjb250YWluZXI/OiBzdHJpbmc7XG4gIGZuQW5jaG9yPzogc3RyaW5nO1xuICByZWZBbmNob3I/OiBzdHJpbmc7XG4gIHRleHQ/OiBzdHJpbmc7XG4gIGJhY2tncm91bmQ/OiBzdHJpbmc7XG59KTogdm9pZCB7XG4gIHRyeSB7XG4gICAgY29uc3QgY29uZmlnID0geyAuLi5vcHRpb25zLCAuLi51c2VyT3B0aW9ucyB9O1xuICAgIGNvbnNvbGUubG9nKGNvbmZpZyk7XG4gICAgY29uc3QgeyBjb250YWluZXIsIGZuQW5jaG9yLCByZWZBbmNob3IsIHRleHQsIGJhY2tncm91bmQgfSA9IGNvbmZpZztcblxuICAgIGNvbnN0IGZuUmUgPSBuZXcgUmVnRXhwKGAke2ZuQW5jaG9yfShcXFxcZCspYCwgXCJnXCIpO1xuICAgIGNvbnN0IHJlZlJlID0gbmV3IFJlZ0V4cChgJHtyZWZBbmNob3J9KFxcXFxkKylgLCBcImdcIik7XG4gICAgY29uc3QgY29tYmluZWRSZSA9IG5ldyBSZWdFeHAoYCgke2ZuQW5jaG9yfXwke3JlZkFuY2hvcn0pXFxcXGQrYCk7XG4gICAgY29uc29sZS5sb2coY29tYmluZWRSZSk7XG4gICAgY29uc3QgYXJ0aWNsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoY29udGFpbmVyKTtcblxuICAgIGlmICghYXJ0aWNsZSkgdGhyb3cgRXJyb3IoXCJObyBjb250YWluZXIgZm91bmQuXCIpO1xuXG4gICAgY29uc3QgY29udGFpbmVyU2l6ZSA9IGFydGljbGU/LnF1ZXJ5U2VsZWN0b3IoXCJwXCIpPy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuICAgIGlmICghY29udGFpbmVyU2l6ZSkgdGhyb3cgRXJyb3IoXCJDYW4ndCBmaW5kIGNvbnRhaW5lciBzaXplXCIpO1xuXG4gICAgY29uc3QgeyB3aWR0aCwgbGVmdCwgcmlnaHQgfSA9IGNvbnRhaW5lclNpemU7XG5cbiAgICBzdHlsZXModGV4dCwgYmFja2dyb3VuZCwgd2lkdGgsIGxlZnQsIHJpZ2h0KTtcblxuICAgIGNvbnN0IG5pID0gZG9jdW1lbnQuY3JlYXRlTm9kZUl0ZXJhdG9yKFxuICAgICAgYXJ0aWNsZSxcbiAgICAgIE5vZGVGaWx0ZXIuU0hPV19FTEVNRU5ULFxuICAgICAgKG5vZGUpID0+IHtcbiAgICAgICAgaWYgKCFub2RlIHx8ICFub2RlLnRleHRDb250ZW50KSByZXR1cm4gTm9kZUZpbHRlci5GSUxURVJfUkVKRUNUO1xuICAgICAgICByZXR1cm4gY29tYmluZWRSZS50ZXN0KG5vZGUudGV4dENvbnRlbnQpXG4gICAgICAgICAgPyBOb2RlRmlsdGVyLkZJTFRFUl9BQ0NFUFRcbiAgICAgICAgICA6IE5vZGVGaWx0ZXIuRklMVEVSX1JFSkVDVDtcbiAgICAgICAgLy8gQUNDRVBULCBSRUpFQ1QgT1IgU0tJUCBiYXNlZCBvblxuICAgICAgICAvLyBjdXN0b20gY3JpdGVyaWFcbiAgICAgIH1cbiAgICApO1xuXG4gICAgaWYgKCFuaS5yZWZlcmVuY2VOb2RlKSB0aHJvdyBFcnJvcihcIlJlZmVyZW5jZSBub2RlIG5vdCBmb3VuZFwiKTtcblxuICAgIGxldCBjdXJyZW50O1xuICAgIGxldCBlbHMgPSBbXTtcblxuICAgIHdoaWxlICgoY3VycmVudCA9IG5pLm5leHROb2RlKCkpKSB7XG4gICAgICBlbHMucHVzaChjdXJyZW50KTtcbiAgICAgIC8vIGNvbnN0IHBhcmVudEVsID0gY3VycmVudDtcbiAgICAgIC8vIGNvbnN0IHN0ciA9IGN1cnJlbnQudGV4dENvbnRlbnQ7XG5cbiAgICAgIC8vIGlmICghcGFyZW50RWwpIHRocm93IEVycm9yKGBObyBwYXJlbnQgZWxlbWVudCwgJHtjdXJyZW50fWApO1xuXG4gICAgICAvLyBpZiAodHlwZW9mIHN0ciAhPT0gXCJzdHJpbmdcIiB8fCAhc3RyKSB0aHJvdyBFcnJvcihcIk5vdGhpbmcgdG8gbWF0Y2hcIik7XG5cbiAgICAgIC8vIGNyZWF0ZUZuKGZuUmUsIHN0ciwgcGFyZW50RWwpO1xuXG4gICAgICAvLyBjcmVhdGVSZWYocmVmUmUsIHN0ciwgcGFyZW50RWwpO1xuICAgIH1cblxuICAgIGNvbnN0IG5vdGVzID0gZWxzLnNsaWNlKDEpO1xuICAgIGxldCBmbjogc3RyaW5nW10gPSBbXSxcbiAgICAgIHJlZjogc3RyaW5nW10gPSBbXTtcbiAgICBub3Rlcy5mb3JFYWNoKChub3RlKSA9PiB7XG4gICAgICBjb25zdCBzdHIgPSBub3RlLnRleHRDb250ZW50O1xuICAgICAgY29uc3QgcGFyZW50RWwgPSBub3RlIGFzIEhUTUxFbGVtZW50O1xuXG4gICAgICBpZiAodHlwZW9mIHN0ciAhPT0gXCJzdHJpbmdcIiB8fCAhc3RyKSB0aHJvdyBFcnJvcihcIk5vdGhpbmcgdG8gbWF0Y2hcIik7XG5cbiAgICAgIGlmICghcGFyZW50RWwpIHRocm93IEVycm9yKGBObyBwYXJlbnQgZWxlbWVudCwgJHtub3RlfWApO1xuXG4gICAgICBsZXQgZm5DaGVjayA9IGNyZWF0ZUZuKGZuUmUsIHN0ciwgcGFyZW50RWwpO1xuXG4gICAgICBmbiA9IFsuLi5mbiwgLi4uZm5DaGVja107XG5cbiAgICAgIGxldCByZWZDaGVjayA9IGNyZWF0ZVJlZihyZWZSZSwgc3RyLCBwYXJlbnRFbCk7XG4gICAgICByZWYgPSBbLi4ucmVmLCAuLi5yZWZDaGVja107XG4gICAgfSk7XG5cbiAgICBpZiAoZm4ubGVuZ3RoICE9PSByZWYubGVuZ3RoKSB7XG4gICAgICBjb25zdCBbbWF4LCBtaW5dID0gZm4ubGVuZ3RoID4gcmVmLmxlbmd0aCA/IFtmbiwgcmVmXSA6IFtyZWYsIGZuXTtcblxuICAgICAgY29uc3QgbWlzc2luZyA9IG1heC5maWx0ZXIoKHZhbCkgPT4gIW1pbi5pbmNsdWRlcyh2YWwpKS5qb2luKFwiLCBcIik7XG5cbiAgICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9IChcbiAgICAgICAgZm46IHN0cmluZ1tdLFxuICAgICAgICByZWY6IHN0cmluZ1tdLFxuICAgICAgICBtaXNzaW5nOiBzdHJpbmdcbiAgICAgICk6IHN0cmluZyA9PiB7XG4gICAgICAgIHJldHVybiBgSXQgbG9va3MgbGlrZSB0aGVyZSBhcmUgbW9yZSAke1xuICAgICAgICAgIGZuLmxlbmd0aCA+IHJlZi5sZW5ndGhcbiAgICAgICAgICAgID8gXCJmb290bm90ZXMgKFwiICtcbiAgICAgICAgICAgICAgZm4ubGVuZ3RoICtcbiAgICAgICAgICAgICAgXCIpXCIgK1xuICAgICAgICAgICAgICBcIiB0aGFuIHJlZmVyZW5jZXMgKFwiICtcbiAgICAgICAgICAgICAgcmVmLmxlbmd0aCArXG4gICAgICAgICAgICAgIFwiKVwiXG4gICAgICAgICAgICA6IFwicmVmZXJlbmNlcyAoXCIgK1xuICAgICAgICAgICAgICByZWYubGVuZ3RoICtcbiAgICAgICAgICAgICAgXCIpXCIgK1xuICAgICAgICAgICAgICBcIiB0aGFuIGZvb3Rub3RlcyAoXCIgK1xuICAgICAgICAgICAgICBmbi5sZW5ndGggK1xuICAgICAgICAgICAgICBcIilcIlxuICAgICAgICB9LiBDaGVjayAke1xuICAgICAgICAgIGZuLmxlbmd0aCA+IHJlZi5sZW5ndGggPyBcImZvb3Rub3RlKHMpXCIgOiBcInJlZmVyZW5jZShzKVwiXG4gICAgICAgIH0gJHttaXNzaW5nfWA7XG4gICAgICB9O1xuICAgICAgdGhyb3cgRXJyb3IoZXJyb3JNZXNzYWdlKGZuLCByZWYsIG1pc3NpbmcpKTtcbiAgICB9XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBjb25zb2xlLmVycm9yKGUpO1xuICB9XG59XG4iXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQVFBLE1BQU0sT0FBTyxHQUFZO0FBQ3ZCLElBQUEsU0FBUyxFQUFFLFNBQVM7QUFDcEIsSUFBQSxRQUFRLEVBQUUsSUFBSTtBQUNkLElBQUEsU0FBUyxFQUFFLElBQUk7QUFDZixJQUFBLFVBQVUsRUFBRSxNQUFNO0FBQ2xCLElBQUEsSUFBSSxFQUFFLE1BQU07Q0FDYjs7QUNkRCxNQUFNLE1BQU0sR0FBRyxDQUNiLElBQVksRUFDWixVQUFrQixFQUNsQixLQUFhLEVBQ2IsSUFBWSxFQUNaLEtBQWEsS0FDTDtBQUNSLElBQUEsTUFBTSxNQUFNLEdBQUcsQ0FBQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7V0FtQ04sS0FBSyxDQUFBOztBQUVxQyxtREFBQSxFQUFBLFVBQVUs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
